# ç¬¬ä¹ç« ï¼šæ³›å‹ Generics

## 9.4 æ³›å‹çš„å·¥ä½œæ–¹å¼(How Generics Work)
æœ¬å°èŠ‚è®²äº†ä¸€äº›å…³äºæ³›å‹```åº•å±‚```çš„çŸ¥è¯†ç‚¹å’Œä¸€äº›```ç‰¹æ®Šæƒ…å†µä¸‹```çš„ä½¿ç”¨ã€‚å¯ä»¥å½“åšæ‰©å……çŸ¥è¯†é¢å»å­¦ä¹ ã€‚

#### æˆ‘ä»¬å…ˆçœ‹çœ‹ä¸€ä¸ªæœ€ç®€å•çš„æ³›å‹å‡½æ•°çš„åº•å±‚å®ç°

    func min<T: Comparable>(_ x: T, _ y: T) -> T { 
        returny<x?y:x
    }

ç¼–è¯‘å™¨æ— æ³•ä¸ºè¿™ä¸ªå‡½æ•°```ç›´æ¥ç”Ÿäº§ä»£ç ```ï¼ŒåŸå› å¦‚ä¸‹ï¼š

    1.ç¼–è¯‘å™¨ä¸çŸ¥é“Tçš„```å˜é‡å¤§å°```
    
    2.ç¼–è¯‘å™¨ä¸çŸ¥é“éœ€è¦è°ƒç”¨çš„<å‡½æ•°æ˜¯å¦æœ‰é‡è½½ï¼Œæ‰€ä»¥ä¹Ÿä¸çŸ¥é“éœ€è¦è°ƒç”¨çš„```å‡½æ•°çš„åœ°å€```
    
swift ä¸ºå‡½æ•°å¼•å…¥äº†ä¸€å¥—é—´æ¥çš„```ä¸­é—´å±‚```æ¥è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œå¼•å…¥äº†ä¸€ä¸ªå®¹å™¨ï¼Œç¼–è¯‘å™¨ä¼šæŠŠæ³›å‹æ”¾åˆ°è¿™ä¸ªå®¹å™¨ä¸­
å¯¹äºæ³›å‹çš„å‚æ•°ï¼Œç¼–è¯‘å™¨è¿˜ç»´æŠ¤äº†ä¸€ä¸ªæˆ–è€…å¤šä¸ª```ç›®å‡»è¡¨(witness table)```ï¼ŒåŒ…æ‹¬ä¸€ä¸ª```å€¼ç›®å‡»è¡¨```ï¼Œä»¥åŠæ¯ä¸ªåè®®çº¦æŸçš„```åè®®ç›®å‡»è¡¨```ã€‚ è¿™äº›è¡¨å°†è¿è¡Œæ—¶çš„å‡½æ•°```åŠ¨æ€æ´¾å‘```åˆ°æ­£ç¡®çš„å®ç°ä¸­ã€‚ è¡¨é‡Œå®é™…ä¸Šæ”¾çš„éƒ½æ˜¯```æŒ‡é’ˆ```ã€‚åŒæ—¶è¿˜è®°å½•äº†```ç±»å‹å¤§å°å’Œå¯¹é½æ–¹å¼```ã€‚


### æ³›å‹ç‰¹åŒ–

å…‰çœ‹æ³›å‹ç‰¹åŒ–è¿™ä¸ªè¯å¾ˆéš¾ç†è§£å®ƒçš„ç”¨æ³•å’Œæ„æ€ï¼Œåé¢æˆ‘ä»¬ä¼šè®²ã€‚

ä½¿ç”¨æ³›å‹ç‰¹åŒ–çš„åŸå› ï¼š
å¤§å®¶å…ˆäº†è§£ä¸€ä¸ªswiftçš„è®¾è®¡ç›®æ ‡ï¼š ```"ç¼–è¯‘ä¸€æ¬¡ï¼ŒåŠ¨æ€æ´¾å‘"```
swift æ³›å‹APIåªéœ€è¦çŸ¥é“æ³›å‹å‡½æ•°æˆ–è€…ç±»å‹çš„å£°æ˜ï¼Œå¹¶```ä¸å…³å¿ƒå®ç°```ã€‚
æ‰€ä»¥ç»“æœçš„ä»£ç ä¸æ˜¯é‚£ä¹ˆç›´æ¥ã€‚è¿™ä¼šå¯¼è‡´```è¿è¡Œæ—¶æ€§èƒ½ä½```

swiftåº“ä¸­æœ‰å¾ˆå¤šæ³›å‹çš„ä½¿ç”¨ï¼Œæ€§èƒ½å¼€é”€å¾ˆå®¹æ˜“å åŠ ã€‚

è¿™é‡Œå°±å¼•å…¥äº†```æ³›å‹ç‰¹åŒ–(generic specialization)``` æ¥é¿å…è¿™ä¸ªä¸å¿…è¦çš„å¼€é”€ã€‚
æ³›å‹ç‰¹åŒ–çš„æœ¬è´¨ï¼š
ç¼–è¯‘å™¨æŒ‰ç…§```å…·ä½“çš„å‚æ•°ç±»å‹```å°†å‡½æ•°è¿›è¡Œ```å¤åˆ¶```ã€‚
æ–‡ç« ä¸€å¼€å§‹çš„ä¾‹å­ä¸­ï¼Œå¯èƒ½é’ˆå¯¹äºIntçš„å‚æ•°ç±»å‹ç‰¹åŒ–å‡ºä¸€ä¸ªæ–¹æ³•æ˜¯è¿™æ ·çš„

        func min(_ x: Int, _ y: Int) -> Int { 
            returny<x?y:x
        }

æ³›å‹ç‰¹åŒ–ä¸ä»…èƒ½```å»æ‰è™šæ‹Ÿæ´¾å‘çš„å¼€é”€```ï¼Œ è¿˜å¯ä»¥è®©```å†…è”```ç­‰è¿›ä¸€æ­¥ä¼˜åŒ–æˆä¸ºå¯èƒ½

æ³›å‹ç‰¹åŒ–çš„å†³å®šåœ¨```ç¼–è¯‘æ—¶```è¿›è¡Œã€‚ç‰¹åŒ–çš„å‚æ•°ç±»å‹å¾ˆå¯èƒ½æ˜¯ä½ ```ç»å¸¸ä½¿ç”¨```çš„å…·ä½“ç±»å‹ï¼Œ
å¦‚æœä½ ç»å¸¸ä½¿ç”¨Int åªç”¨è¿‡ä¸€æ¬¡float  é‚£ä¹ˆå°±ä¼šç‰¹åŒ–å‡ºä¸Šé¢çš„å‡½æ•°ã€‚

ç¼ºç‚¹ï¼šæ³›å‹å®šä¹‰å’Œè°ƒç”¨åœ¨```åŒä¸€ä¸ªæ–‡ä»¶ä¸­```æ—¶ï¼Œæ³›å‹ç‰¹åŒ–æ‰èƒ½å·¥ä½œï¼Œåªèƒ½åœ¨æ¨¡å—å†…ä½¿ç”¨ğŸ˜…(æ ‡å‡†åº“ä¸­çš„æ³›å‹æ–¹æ³•é™¤å¤–ï¼Œå› ä¸ºæ ‡å‡†åº“çš„å®šä¹‰å¯¹äºæ‰€æœ‰æ¨¡å—éƒ½æ˜¯å¯è§çš„)


### å…¨æ¨¡å—ä¼˜åŒ–

å› ä¸ºæ³›å‹ç‰¹åŒ–æ˜¯ä¸€ä¸ªå¾ˆä¸¥é‡çš„é™åˆ¶ï¼Œæ‰€ä»¥ç¼–è¯‘å™¨å¼•å…¥äº†ä¸€ä¸ªæ ‡å¿—æ¥å¯ç”¨```å…¨æ¨¡å—ä¼˜åŒ–```

å¯ä»¥é€šè¿‡å‘ swiftc ä¼ é€’ -whole-module-optimization æ¥å¼€å¯å…¨æ¨¡å—ä¼˜åŒ–

ä¸€èˆ¬éƒ½æ˜¯åœ¨```å‘å¸ƒç‰ˆæœ¬ä¸­```è¿›è¡Œè¿™é¡¹æ“ä½œï¼Œ

```ä¼˜ç‚¹ï¼š```å¤§å¹…åº¦æå‡æ€§èƒ½
```ç¼ºç‚¹ï¼š```ä¼šå¸¦æ¥æ›´é•¿çš„ç¼–è¯‘æ—¶é—´


#### @_specialize å…³é”®å­—

[@_specialize](https://github.com/apple/swift/blob/master/docs/Generics.rst#specialization) æ˜¯ä¸€ä¸ª```éå®˜æ–¹```çš„æ ‡ç­¾ï¼Œè®¡åˆ’å°†æ¥ä¼šå¼•å…¥åˆ°æ ‡å‡†åº“ä¸­ã€‚
ä½œç”¨ï¼šå°†ä½ çš„æ³›å‹ä»£ç è¿›è¡ŒæŒ‡å®šç‰ˆæœ¬çš„ç‰¹åŒ–ï¼Œä½¿å…¶åœ¨```å…¶ä»–æ¨¡å—ä¸­```ä¹Ÿå¯ç”¨ã€‚(ä½ å¿…é¡»è¦æŒ‡æ˜æƒ³è¦è¿›è¡Œç‰¹åŒ–çš„ç±»å‹åˆ—è¡¨)
ä½¿ç”¨å¦‚ä¸‹ï¼š

    @_specialize(exported: true, where T == Int)
    @_specialize(exported: true, where T == String) 
    public func min<T: Comparable>(_ x: T, _ y: T) -> T {
        returny<x?y:x 
    }
    
 2019.4.20ï¼š
    æ³›å‹ç‰¹åŒ–çš„æ›´å¤šç›¸å…³çŸ¥è¯†ç‚¹è¿™é‡Œæ¨è[mediumçš„æ–‡ç« Generic Specialization of functions in Swift ](https://medium.com/@lucianoalmeida1/specialization-of-generic-functions-in-swift-786b64ac3442) ä»å¤´ä»‹ç»äº†ä¸€éæ³›å‹ç‰¹åŒ–ã€‚
over~

