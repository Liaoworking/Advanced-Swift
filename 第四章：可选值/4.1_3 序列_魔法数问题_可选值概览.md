# å¯é€‰å€¼

##  4.1å“¨å²—å€¼ Sentinel Value
å®šä¹‰ï¼šæœ‰çš„å‡½æ•°å¯èƒ½è¿”å›nil å½“å‡½æ•°è¿”å›nil æˆ‘ä»¬å°†è¿”å›å€¼ ç”¨ä½œ-1 ç­‰ç±»ä¼¼çš„å€¼ä»£æ›¿ï¼Œè¿™æ ·çš„å€¼å°±è¢«ç§°ä¸º["å“¨å²—å€¼"](https://en.wikipedia.org/wiki/Sentinel_value) ä¹Ÿå«é­”æ³•æ•°ã€‚



## 4.2é€šè¿‡æšä¸¾æ¥è§£å†³é­”æ³•æ•°çš„é—®é¢˜
swiftä¸­Optionalçš„æœ¬è´¨æ˜¯ä¸€ä¸ªæšä¸¾(ç›®å‰å¯ä»¥å…ˆä¸å…·ä½“æ€è€ƒï¼Œç­‰ä»¥åçš„é¡¹ç›®ä¸­æ…¢æ…¢å°±é¢†æ‚Ÿåˆ°äº†)ã€‚

    enum Optional<Wrapped> {
        case none //ä¸ºç©º
        case some(wrapped) // æœ‰å€¼
    }
    

çŸ¥è¯†ç‚¹ï¼šå½“è¿”å›å€¼ä¸ºå¯é€‰å€¼ ? æ—¶ï¼Œå®è´¨ä¸Šè¿”å›çš„æ˜¯ä¸€ä¸ªOptionalçš„æšä¸¾

        ///è¿”å›å€¼ä¸ºOptionalçš„å®è´¨
        let strArray = ["one","two","three"]
        switch strArray.index(of: "four") {
        case .none:
            print("è¿”å›å€¼ä¸ºç©º") //è¿”å›å€¼ä¸ºç©º
        case .some(let idx):
            print(idx)
            print("æœ‰å€¼")
        }

## 4.3å¯é€‰å€¼æ¦‚è§ˆï¼šOptional

### if let  
ç›¸ä¿¡å¤§å®¶åœ¨swift å…¥é—¨çš„æ—¶å€™å°±å·²ç»èƒ½å¾ˆå¥½çš„ä½¿ç”¨è¿™ä¸ªè¯­æ³•äº†ã€‚ ä¸èµ˜è¿°ã€‚

#### æŠ€å·§1ï¼š å¯ä¸Bool è”åˆåˆ¤æ–­
    if let obj = Optional , Bool {
        /// å‰é¢æœ‰å€¼ä¸”åé¢Boolä¸ºtrueæ‰§è¡Œ
    }

#### æŠ€å·§2ï¼š å¤šlet å¹¶åˆ—ã€‚ è¿™ä¸ªåœ¨å¼€å‘ä¸­ä¹Ÿç»å¸¸ç”¨åˆ°

    if let obj1 = Optional1, let obj2 = Optional2, ....{
    ///å½“ä¸Šé¢çš„letåˆ¤æ–­éƒ½æœ‰å€¼çš„æ—¶å€™æ‰§è¡Œ
    }


### while let 
ç±»ä¼¼äºif let é‡åˆ°```nilæ—¶ç»ˆæ­¢å¾ªç¯```
ä¹Ÿæœ‰å’Œä¸Šé¢ğŸ‘†æŠ€å·§1ï¼ˆ```ä¸€æ—¦ä¸ºfalse å°±å¾ªç¯åœæ­¢ï¼Œå¹¶ä¸æ˜¯filteré‚£æ ·å»å·¥ä½œ```ï¼‰ç›¸åŒçš„ä½¿ç”¨æ–¹æ³•ã€‚ä¸èµ˜è¿°ã€‚
      
        while let line = printLine() {
        ///å½“printLineä¸ºç©ºæ—¶å€™ç»ˆæ­¢å¾ªç¯
            print(line)
        }


### åŒé‡å¯é€‰å€¼:
ä¸€ä¸ªå¯é€‰å€¼å¯èƒ½ä¼šè¢«å¦å¤–ä¸€ä¸ªå¯é€‰å€¼åŒ…è£…èµ·æ¥ï¼Œå½¢æˆäº†å¯é€‰å€¼çš„åµŒå¥—ã€‚ä½ ä¹Ÿå¯ä»¥ç†è§£æˆobj?? ã€‚å¹³æ—¶åœ¨å¤æ‚é€»è¾‘æ“ä½œæ—¶æ³¨æ„ä¸€å“ˆå°±å¯ä»¥äº†ã€‚

### if var å’Œ while var
å’Œ let çš„ä½¿ç”¨ç±»ä¼¼ã€‚ ä½†ä½ var å‡ºæ¥çš„objå®é™…ä¸Šæ˜¯ä¸€ä¸ª```æœ¬åœ°å‰¯æœ¬```  ä½ å¯¹objåšä»»ä½•æ›´æ”¹éƒ½```ä¸ä¼šå½±å“```åŸæ¥çš„å€¼ã€‚
 
     ///if var çš„æ”¹å˜ä¸å½±å“åŸå€¼
            let dict:[String:String]?
            dict = ["key1":"value1"]
            if var varDict = dict {
                varDict["key1"] = "value2"
            }
            print(dict) //Optional(["key1": "value1"])


### è§£åŒ…åå¯é€‰å€¼çš„ä½œç”¨åŸŸ
    if let obj = Optional {
    ///objçš„ä½œç”¨åŸŸ
    }

#### æ³¨:æœ‰æ—¶å€™æˆ‘ä»¬éœ€è¦```æå‰é€€å‡º```æ¥é¿å…çƒ¦äººçš„ifåµŒå¥—ï¼Œè¿™ä¸ªæ—¶å€™ ```guard let``` çš„ä¼˜ç‚¹é©¬ä¸Šå°±ä½“ç°å‡ºæ¥äº†.

    ///ä¸ºç©ºæå‰é€€å‡º
    guard let obj = Optional else{return}



### å¯é€‰é“¾
OCä¸­å¯¹nilå‘é€æ¶ˆæ¯nothing had happenedã€‚ åœ¨swiftä¸­å¯ä»¥é€šè¿‡å¯é€‰é“¾ï¼ˆOptional chainingï¼‰è¾¾åˆ°ä¸€æ ·çš„æ•ˆæœ

é‚£ä¹ˆé—®é¢˜æ¥äº†ï¼Œä»€ä¹ˆæ˜¯å¯é€‰é“¾ï¼Ÿ
```å¯é€‰é“¾``` ä¸­çš„å¯é€‰æ˜¯```?```,å¯ä»¥æŠŠé“¾ç†è§£æˆswiftä¸­çš„ç‚¹è¯­æ³•,å¯ä»¥åœ¨ã€Šswifté“¾å¼ç¼–ç¨‹ã€‹ä¸€ä¹¦ä¸­å¯¹è¿™ä¸ªæœ‰æ›´æ·±çš„ç†è§£

    delegate?.callback() //å°±æ˜¯ä¸€ä¸ªå¯é€‰é“¾ã€‚

    //å½“ä¸Šé¢çš„delegateä¸ºå¯é€‰æ—¶ç¼–è¯‘å™¨ä¼šå‘å‡ºè­¦å‘Šã€‚ ç¡®å®æœ‰å€¼æ–¹æ³•ä¼šè¢«è°ƒç”¨ã€‚æ²¡æœ‰å€¼æ—¶å€™æ–¹æ³•ä¸ä¼šè¢«è°ƒç”¨ã€‚
    
   
   ps. ğŸ˜‚å†™äº†è¿™ä¹ˆå¤šå¹´swiftçš„delegateå’Œé—­åŒ… ç›´åˆ°è‡ªå·±å†™ç¬”è®°çš„æ—¶å€™æ‰å‘ç°è‡ªå·±å†™å¤æ‚äº†(ä¸€ç‚¹swiftçš„ä¼˜ç‚¹éƒ½æ²¡ä½“ç°å‡ºæ¥ã€‚ã€‚ã€‚)
   
    var voidCallback:(()-> Void)?
        
        ///å¯¹äºé—­åŒ…è°ƒç”¨çš„ä¸¤ç§å†™æ³•
        //âŒä¸æ¨è
        if voidCallback != nil {
            voidCallback!()
        }
        
        //âœ… æ¨è
        voidCallvack?()
        

#### å¤šä¸ªå¯é€‰é“¾çš„è°ƒç”¨ã€‚ä¸‹é¢è¿™ä¸ªä¾‹å­ç®€å•æ˜“æ‡‚ï¼Œä¸èµ˜è¿°ã€‚

    extension Int {
        
        var half: Int? {
            guard self > 1 else {return nil}
            return self/2
        }
        
    }
    ///å¤šå¯é€‰é“¾è°ƒç”¨
    20.half?.half?.half //Optional(2)


### nilåˆå¹¶è¿ç®—ç¬¦ ??   (é¡¹ç›®ä¸­ç»å¸¸ä¼šç”¨åˆ°ï¼ï¼å¯ä»¥è®©ä½ çš„ä»£ç å†™çš„å¾ˆä¼˜ç¾~)
ä¸€å¼€å§‹çœ‹åˆ°æ ‡é¢˜```nilåˆå¹¶è¿ç®—ç¬¦```çš„æ—¶å€™æˆ‘æ˜¯ğŸ˜³çš„ã€‚è¿™éƒ½æ˜¯å•¥å•¥å•¥å•Šã€‚   å½“æˆ‘çœ‹åˆ° ```??``` è¿™ä¸ªç¬¦å·æ—¶å€™è±ç„¶å¼€æœ—ã€‚ä¸¤ä¸ªæ˜¯ä¸€ä¸ªæ„æ€ é¡¹ç›®é‡Œé¢å·²ç»ç”¨è¿‡å¾ˆå¤šæ¬¡äº†ï¼Œç™¾è¯•ä¸çˆ½ã€‚
 
```ä½¿ç”¨åœºæ™¯```:  å½“å»è§£åŒ…```!```ä¸€ä¸ªå¯é€‰å€¼ï¼Œä¸”å½“è¿™ä¸ªå¯é€‰å€¼ä¸ºnilæ—¶ï¼Œæˆ‘ä»¬è¦å»èµ‹ä¸€ä¸ª```é»˜è®¤å€¼```é˜²æ­¢å´©æºƒ  è¿™ä¸ªæ—¶å€™å°±ç”¨åˆ°äº† ```??```   

        var number: Int?
        number = nil
        String(number ?? 5) //5 

æ„Ÿè§‰ä¸Šæ˜¯å’ŒOC ä¸­çš„ ä¸‰ç›®è¿ç®—ç¬¦ Bool ï¼Ÿ A: B ç±»ä¼¼
éœ€è¦å¼ºè°ƒçš„æ˜¯å¯é€‰å€¼```ä¸æ˜¯æŒ‡é’ˆ```

### å¯é€‰å€¼map
### å¯é€‰å€¼flatMap(Demoå€¼å¾—å€Ÿé‰´)
ä¸Šé¢ä¸¤å°èŠ‚è®²çš„éƒ½æ˜¯map å’ŒflatMapå¯¹äºå¯é€‰å€¼çš„ä¸€ä¸ªç”¨æ³•ã€‚
æœ‰ä¸€ä¸ªå°demoå¯¹äºæ—¥å¸¸å¼€å‘å¯ä»¥è¯´æ˜¯æœ‰ç€```å››ä¸¤æ‹¨åƒæ–¤```çš„æ„Ÿè§‰ï¼Œå¦‚ä¸‹ï¼š

        ///å°†ä¸€ä¸ªç½‘ç»œå›¾ç‰‡åŠ è½½å‡ºæ¥çš„å¥‡æ·«æ–¹æ³•ï¼ï¼ï¼
        let urlString = "http://www.objc.io/logo.png"
        let view = URL(string: urlString)
            .flatMap { (url) -> Data? in
            try? Data(contentsOf: url)
            }
            .flatMap { (data) -> UIImage? in
                UIImage(data: data)
            }
            .map { (image) -> UIImageView in
                UIImageView(image: image)
        }
        
        if let view = view {
            UIView().addSubview(view)
        }

åˆ©ç”¨swiftä¸­çš„```$0```è¯­æ³•ç®€åŒ–ä¸Šé¢çš„ä»£ç 


        let view2 = URL(string: urlString)
            .flatMap {
                try? Data(contentsOf: $0)
            }
            .flatMap {
                UIImage(data: $0)
            }
            .map {
                UIImageView(image: $0)
        }
        
        if let view2 = view2 {
            UIView().addSubview(view2)
        }

è¿™é‡Œçš„```flatMap```å’Œ```if let``` éå¸¸ç›¸ä¼¼ã€‚
è¿™æ ·æˆ‘ä»¬å°±å°†ä¸€ä¸ªç½‘ç»œå›¾ç‰‡åŠ è½½å‡ºæ¥äº†ã€‚
æƒ³æƒ³è‡ªå·±ä¹‹å‰å†™äº†é‚£ä¹ˆå¤šçš„åƒåœ¾ä»£ç ï¼Œä¸ç¦é•¿å¹ä¸€å¥ï¼š```swiftğŸ‚ğŸºï¼ï¼ï¼```

### ä½¿ç”¨flatMapè¿‡æ»¤nil
åŒæ ·è¿™é‡Œæˆ‘ä»¬ç”¨ä¸€ä¸ªdemoå»è¯´æ˜ç”¨æ³•

```ç›®çš„```:æˆ‘ä»¬æƒ³è¦æ±‚ä¸€ä¸ªå­—ç¬¦ä¸²æ•°ç»„ä¸­çš„æ•°å­—å’Œã€‚

        let numbers = ["1","2","3","4","liaoworking"]
        ///æ™®é€šé’å¹´
        var sum = 0
        for case let i? in numbers.map({
            Int($0)
        }) {
            sum += i// Int($0)ä¸ºnilå°±ä¸èµ°è¿™é‡Œäº†
        }
        //        sumçš„å€¼ä¸º10
        
        ///ä¼˜è´¨é’å¹´
        ///å½“æˆ‘ä»¬ç”¨?? æŠŠnilæ›¿æ¢æˆ0
        numbers.map { Int($0) }.reduce(0) { $0 + ($1 ?? 0)} //10
        
        ///æ–‡è‰ºé’å¹´
        ///åœ¨æ ‡å‡†åº“ä¸­flatMapçš„ä½œç”¨å¯èƒ½æ­£æ˜¯ä½ æƒ³è¦
        numbers.flatMap { Int($0) }.reduce(0, +) // 10
        ///ä¸Šé¢æ–¹æ³•å·²ç»è¢«è‹¹æœåºŸå¼ƒï¼Œç”¨ä¸‹é¢æ–¹æ³•ä»£æ›¿
        numbers.compactMap { Int($0) }.reduce(0, +) // 10

æ³¨ï¼šè¿™é‡Œçš„flatMapçš„ä½œç”¨ï¼šæŠŠä¸€ä¸ªæ˜ å°„ä¸ºå¯é€‰å€¼çš„åºåˆ—è¿›è¡Œå±•å¹³ã€‚

è¿™ä¸ªä¾‹å­çš„ç¡®å¥½åŠï¼Œ```ä¸è‡ªå·±å†™ä¸€éä¸çŸ¥é“è¿˜æœ‰å¾ˆå¤šé«˜çº§ç”¨æ³•è‡ªå·±ä¸ä¼šã€‚``` å­¦ä¹ äº†å­¦ä¹ äº†~

å¦‚æœè®©æˆ‘å»é¢è¯•swiftå¼€å‘ã€‚ä¸€å®šä¼šé€‰è¿™ä¸ªdemoåšä¸€ä¸ªé¢è¯•é¢˜!

### å¯é€‰å€¼åˆ¤ç­‰
##### åˆ¤ç­‰æ—¶æˆ‘ä»¬å¹¶ä¸å…³å¿ƒå¯é€‰å€¼æ˜¯ä¸æ˜¯nilï¼Œåªç”¨å»ç®¡å®ƒ```æ˜¯å¦åŒ…å«```æˆ‘ä»¬æƒ³è¦çš„```énilçš„ç‰¹å®šå€¼```å³å¯ã€‚



### switch case åŒ¹é…å¯é€‰å€¼

    /// switch case
        let numbers = ["1","2","3","4","liaoworking"]
        for i in numbers {
            switch Int(i) {
            case 0:
                print("0")
            case nil:
                print("can't convert to int")
            default:
                print("not in case")
            }
        }
 
swiftä¸­caseåŒ¹é…æ˜¯é€šè¿‡~=è¿ç®—ç¬¦è¿›è¡Œçš„ã€‚  æˆ‘ä»¬å¯ä»¥å®ç°è¿™ä¸ªæ–¹æ³•å¢åŠ å¯¹```èŒƒå›´```(0..<num)åŒ¹é…çš„æ–¹æ³•

###å¯é€‰å€¼çš„æ¯”è¾ƒ
å’Œ == ç±»ä¼¼   å¯é€‰å€¼æ›¾ç»ä¹Ÿæœ‰  <=, >=, <, >æ“ä½œç¬¦   åæ¥åœ¨[SE-0121](https://github.com/apple/swift-evolution/blob/master/proposals/0121-remove-optional-comparison-operators.md)å› ä¸º```å®‰å…¨åŸå› ```è¢«ç§»é™¤äº†ã€‚

    
    ///åœ¨ä¸€ä¸ªæ¸©åº¦æ•°ç»„ä¸­
    let temp = ["-23", "0", "66.66", "warm"]
    
    Double("warm") çš„å€¼ä¸ºnil

    Double("warm") < 0 æ˜¯æˆç«‹çš„
    
    ä½†ä½ ä¸èƒ½è¯´warmæ˜¯å°äº0åº¦çš„æ˜¯å¾ˆå†·çš„ã€‚
    
    
    
è¿™æ˜¾ç„¶ä¸åˆæƒ…ç†ã€‚

