#### 
# ç¬¬åç« ï¼šåè®® Protocol Protocol-Oriented Programming

## å‰è¨€ï¼š

swift ä¸­çš„åè®®è¿˜æ˜¯```å¾ˆé…·çš„```ğŸ˜

1.å¯ä»¥å½“åš```ä»£ç†```æ¥ä½¿ç”¨ã€‚

2.å¯ä»¥è®©```ç»“æ„ä½“```ï¼Œ```æšä¸¾```æ¥æ»¡è¶³åè®®ã€‚

3.è¿˜å¯ä»¥é€šè¿‡åè®®çš„```extension```ä¸ºåè®®æ·»åŠ æ–°æ–¹æ³•ã€‚

4.åè®®å…è®¸æˆ‘ä»¬```åŠ¨æ€æ´¾å‘```ã€‚

5.OCä¸­å…±äº«ä»£ç é€šå¸¸ä½¿ç”¨çš„ç»§æ‰¿ï¼Œswiftä¸­å¯ä»¥é€šè¿‡ä½¿ç”¨çš„æ˜¯åè®®æ¥```å…±äº«ä»£ç ```ã€‚

6.ä½ å¯ä»¥ä¸ºä½ çš„ç±»æ·»åŠ åè®®å»è¾¾åˆ°```åŠŸèƒ½ç‚¹æ•´åˆ```ã€‚



## 10.1 é¢å‘åè®®ç¼–ç¨‹ Overload Resolution for Free Functions 
è¿™ä¸€å°èŠ‚ä¸¾äº†ä¸ªä¾‹å­æ¥ä»‹ç»é¢ç›¸åè®®ç¼–ç¨‹çš„å‡ ä¸ª```ä½¿ç”¨åœºæ™¯```ã€‚


#### å›¾å½¢æ¸²æŸ“çš„Demo
å°† Core Graphics çš„ CGContext æ¸²æŸ“åˆ°å±å¹•ä¸Šï¼Œæˆ–è€…åˆ›å»ºä¸€ä¸ª SVG æ ¼å¼çš„å›¾å½¢æ–‡ä»¶ã€‚æˆ‘ä»¬å¯ä»¥ä»å®šä¹‰ç»˜å›¾ API çš„æœ€ å°åŠŸèƒ½é›†çš„åè®®å¼€å§‹è¿›è¡Œå®ç°

1.å…ˆå†™åè®®æ–¹æ³•

    protocol Drawing {
        mutating func addEllipse(rect: CGRect, fill: UIColor) mutating 
        func addRectangle(rect: CGRect, fill: UIColor)
    }

2.ä¸ºCGContextæ·»åŠ æ‰©å±•æ¥æ»¡è¶³åè®®

    extension CGContext: Drawing {
        func addEllipse(rect: CGRect, fill: UIColor) {
            setFillColor(fill.cgColor)
            fillEllipse(in: rect) }
        func addRectangle(rect: CGRect, fill fillColor: UIColor) { 
            setFillColor(fillColor.cgColor)
            fill(rect)
        } 
    }

3. å¯¹è‡ªå®šä¹‰çš„SVGç±»æ·»åŠ æ‰©å±•æ¥æ»¡è¶³åè®®
  
           struct SVG {
                /// XMLNodeç±»æ˜¯è‡ªå®šä¹‰ç±»ï¼Œè¿™é‡Œçœå»äº†ç±»å®ç°ä»£ç ã€‚
                var rootNode = XMLNode(tag: "svg")
                mutating func append(node: XMLNode) {
            rootNode.children.append(node) }
        }
   
        extension SVG: Drawing {
            mutating func addEllipse(rect: CGRect, fill: UIColor) {
                var attributes: [String:String] = rect.svgAttributes attributes["fill"] = String(hexColor: fill)
                append(node: XMLNode(tag: "ellipse", attributes: attributes))
            }
            mutating func addRectangle(rect: CGRect, fill: UIColor) {
                var attributes: [String:String] = rect.svgAttributes attributes["fill"] = String(hexColor: fill)
                append(node: XMLNode(tag: "rect", attributes: attributes))
            }
        }

4.æ­£å¼ä½¿ç”¨

    var context: Drawing = SVG()
    let rect1 = CGRect(x: 0, y: 0, width: 100, height: 100)
    let rect2 = CGRect(x: 0, y: 0, width: 50, height: 50) 
    context.addRectangle(rect: rect1, fill: .yellow) 
    context.addEllipse(rect: rect2, fill: .blue)


### åè®®æ‰©å±• 
ç»å¸¸çœ‹swiftæ ‡å‡†åº“APIçš„åŒå­¦è‚¯å®šéƒ½ç”¨è§è¿‡ è‹¹æœå®˜æ–¹å¯¹åè®®æ‰©å±•çš„ä½¿ç”¨ã€‚
è¿™é‡Œè®²è®²ä¼˜ç‚¹ï¼š
1.ä¸éœ€è¦è¢«å¼ºåˆ¶ä½¿ç”¨æŸä¸ªçˆ¶ç±»

2.å¯ä»¥è®©å·²ç»å­˜åœ¨çš„ç±»å‹æ»¡è¶³åè®®(æ¯”å¦‚æˆ‘ä»¬è®©CGContextæ»¡è¶³äº†Drawing)ã€‚å­ç±»å°±æ²¡é‚£ä¹ˆçµæ´»äº†ï¼Œå¦‚æœ CGContext æ˜¯ä¸€ä¸ªç±»çš„è¯ï¼Œæˆ‘ä»¬æ— æ³•ä»¥è¿½æº¯çš„æ–¹å¼å»å˜æ›´å®ƒçš„çˆ¶ç±»ã€‚

3.åè®®æ—¢å¯ä»¥ç”¨äºç±»ï¼Œä¹Ÿå¯ä»¥ç”¨äºç»“æ„ä½“ï¼Œè€Œçˆ¶ç±»å°±æ— æ³•å’Œç»“æ„ä½“ä¸€èµ·ä½¿ç”¨äº†

4.å½“å¤„ç†åè®®æ—¶ï¼Œæˆ‘ä»¬æ— éœ€æ‹…å¿ƒæ–¹æ³•é‡å†™æˆ–è€…åœ¨æ­£ç¡®çš„æ—¶é—´è°ƒç”¨superè¿™æ ·çš„é—®é¢˜

### åœ¨åè®®æ‰©å±•ä¸­é‡å†™æ–¹æ³•

æ²¿ç€ä¸Šé¢çš„Demoæˆ‘ä»¬å†çœ‹ä¸€ä¸ªä½¿ç”¨åœºæ™¯ã€‚

    extension SVG {
        mutating func addCircle(center: CGPoint, radius: CGFloat, fill: UIColor) {
        var attributes: [String:String] = [ "cx": "\(center.x)",
        "cy": "\(center.y)",
        "r": "\(radius)",
        ]
        attributes["fill"] = String(hexColor: fill)
        append(node: XMLNode(tag: "circle", attributes: attributes))
        } 
    }

æˆ‘ä»¬å»è°ƒç”¨ï¼š
    
    var sample = SVG()
    sample.addCircle(center: .zero, radius: 20, fill: .red) print(sample)
    /*
    <svg>
    <circle cy="0.0" fill="#010000" r="20.0" cx="0.0"/> </svg>
    */

å‘ç°æ­£å¦‚æˆ‘ä»¬æ‰€é¢„æ–™çš„ï¼Œ

å¦‚æœæˆ‘ä»¬æŠŠsampleå¼ºè½¬ä¸ºDrawing

    var otherSample: Drawing = SVG() otherSample.addCircle(center: .zero, radius: 20, fill: .red)
    print(otherSample)
    /*
    <svg>
    <ellipse cy="-20.0" fill="#010000" ry="40.0" rx="40.0" cx="-20.0"/> </svg>
    */

å®ƒè¿”å›çš„æ˜¯ ellipse å…ƒç´ ï¼Œè€Œä¸æ˜¯æˆ‘ä»¬æ‰€æœŸæœ›çš„ circleã€‚
å½“æˆ‘ä»¬å°† otherSample å®šä¹‰ä¸º Drawing ç±»å‹çš„å˜é‡æ—¶ï¼Œç¼–è¯‘å™¨ä¼šè‡ªåŠ¨å°† SVG å€¼å°è£…åˆ°ä¸€ä¸ªä»£è¡¨åè®®çš„ç±»å‹ä¸­ï¼Œè¿™ä¸ªå°è£…è¢«ç§°ä½œ```å­˜åœ¨å®¹å™¨``` (existential container)

å½“æˆ‘ä»¬å¯¹å­˜åœ¨å®¹å™¨è°ƒç”¨ addCircle æ—¶ï¼Œæ–¹æ³•æ˜¯```é™æ€æ´¾å‘```çš„

æƒ³è¦å°† addCircle å˜ä¸ºåŠ¨æ€æ´¾å‘ï¼Œæˆ‘ä»¬å¯ä»¥å°†å®ƒ```æ·»åŠ åˆ°åè®®å®šä¹‰é‡Œ```:

    protocol Drawing {
        mutating func addEllipse(rect: CGRect, fill: UIColor)
        mutating func addRectangle(rect: CGRect, fill: UIColor)
        mutating func addCircle(center: CGPoint, radius: CGFloat, fill: UIColor)
    }

è¿™ä¸ªæ—¶å€™addCircle æ–¹æ³•å˜ä¸ºäº†åè®®çš„ä¸€ä¸ª```è‡ªå®šä¹‰å…¥å£```
    

